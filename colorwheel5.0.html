<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业色轮工具</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #757575;
            --white: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-gray);
            padding: 20px;
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-weight: 300;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 30px;
            gap: 30px;
        }
        
        .wheel-section {
            flex: 1;
            min-width: 300px;
        }
        
        .controls-section {
            flex: 0 0 300px;
        }
        
        #wheel-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            aspect-ratio: 1/1;
        }
        
        #color-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000
            );
            position: relative;
            cursor: grab;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease-out;
            touch-action: none;
        }
        
        #color-wheel.dragging {
            cursor: grabbing;
            transition: none;
        }
        
        .color-marker {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .color-marker:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.4);
        }
        
        .color-marker.active {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.8), 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 20;
        }
        
        .controls-panel {
            background-color: var(--white);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: 100%;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .control-group h3 svg {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }
        
        select, input[type="color"], button {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        select:focus, input[type="color"]:focus, button:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            background-color: #3367d6;
        }
        
        button svg {
            margin-right: 8px;
        }
        
        button.secondary {
            background-color: var(--medium-gray);
            color: var(--text-color);
        }
        
        button.secondary:hover {
            background-color: #d0d0d0;
        }
        
        button.accent {
            background-color: var(--accent-color);
        }
        
        button.accent:hover {
            background-color: #d33426;
        }
        
        .color-value {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 8px 12px;
            background-color: var(--light-gray);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
        }
        
        .color-value-preview {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .color-card {
            width: 120px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .color-card:hover {
            transform: translateY(-5px);
        }
        
        .color-swatch {
            height: 80px;
            position: relative;
        }
        
        .color-info {
            padding: 12px;
            background-color: var(--white);
        }
        
        .color-hex {
            font-weight: bold;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .color-rgb {
            font-size: 0.85rem;
            color: var(--dark-gray);
            font-family: 'Courier New', monospace;
        }
        
        .copy-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            border: none;
            padding: 0;
        }
        
        .color-swatch:hover .copy-btn {
            opacity: 1;
        }
        
        .copy-btn svg {
            width: 16px;
            height: 16px;
        }
        
        .tab-container {
            margin-top: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .controls-section {
                flex: 1;
            }
            
            #wheel-container {
                max-width: 100%;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .color-card {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .color-card:nth-child(1) { animation-delay: 0.1s; }
        .color-card:nth-child(2) { animation-delay: 0.2s; }
        .color-card:nth-child(3) { animation-delay: 0.3s; }
        .color-card:nth-child(4) { animation-delay: 0.4s; }
        .color-card:nth-child(5) { animation-delay: 0.5s; }
        
        /* 优化后的标记点样式 */
        .color-marker.dragging {
            transform: translate(-50%, -50%) scale(1.3);
            z-index: 100;
        }
        
        .color-marker.at-edge {
            border-color: #ff0000;
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: translate(-50%, -50%) scale(1); }
            to { transform: translate(-50%, -50%) scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>专业色轮工具</h1>
            <p class="subtitle">设计与开发者的色彩解决方案</p>
        </header>
        
        <div class="main-content">
            <div class="wheel-section">
                <div id="wheel-container">
                    <div id="color-wheel"></div>
                    <!-- 5个颜色标记点 -->
                    <div class="color-marker" data-angle="0" data-index="0"></div>
                    <div class="color-marker" data-angle="60" data-index="1"></div>
                    <div class="color-marker" data-angle="300" data-index="2"></div>
                    <div class="color-marker" data-angle="240" data-index="3"></div>
                    <div class="color-marker" data-angle="120" data-index="4"></div>
                </div>
                
                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="palette">调色板</div>
                        <div class="tab" data-tab="export">导出</div>
                        <div class="tab" data-tab="info">信息</div>
                    </div>
                    
                    <div class="tab-content active" id="palette-tab">
                        <div class="color-palette" id="color-palette">
                            <!-- 颜色卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="export-tab">
                        <div class="control-group">
                            <h3>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                导出格式
                            </h3>
                            <select id="export-format">
                                <option value="hex">HEX 颜色代码</option>
                                <option value="rgb">RGB 值</option>
                                <option value="hsl">HSL 值</option>
                                <option value="css">CSS 变量</option>
                                <option value="json">JSON 格式</option>
                            </select>
                            <button id="copy-all-btn" class="secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                </svg>
                                复制全部
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <h3>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                导出结果
                            </h3>
                            <textarea id="export-output" rows="6" style="width: 100%; padding: 10px; border: 1px solid var(--medium-gray); border-radius: 8px; font-family: 'Courier New', monospace;" readonly></textarea>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="info-tab">
                        <div class="control-group">
                            <h3>关于色轮工具</h3>
                            <p>这是一个专业的色彩选择工具，可以帮助设计师和开发者创建完美的配色方案。</p>
                            <p>使用方法：</p>
                            <ol style="margin-left: 20px; margin-top: 10px;">
                                <li>旋转色轮选择基础色调</li>
                                <li>选择色彩规则（如类似色、互补色等）</li>
                                <li>拖动色点微调颜色位置</li>
                                <li>从调色板中复制您喜欢的颜色</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="controls-section">
                <div class="controls-panel">
                    <div class="control-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                            </svg>
                            色彩规则
                        </h3>
                        <select id="color-rule">
                            <option value="analogous">类似色 (Analogous)</option>
                            <option value="monochromatic">单色 (Monochromatic)</option>
                            <option value="triad">三色 (Triad)</option>
                            <option value="complementary">互补色 (Complementary)</option>
                            <option value="split-complementary">分裂互补色 (Split Complementary)</option>
                            <option value="double-complementary">双重互补色 (Double Complementary)</option>
                            <option value="square">四色 (Square)</option>
                            <option value="compound">复合色 (Compound)</option>
                            <option value="shades">阴影 (Shades)</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            基础颜色
                        </h3>
                        <input type="color" id="base-color" value="#ff0000">
                        <div class="color-value">
                            <div class="color-value-preview" style="background-color: #ff0000;"></div>
                            <span id="base-color-value">#ff0000</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                            操作
                        </h3>
                        <button id="random-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            随机配色
                        </button>
                        <button id="reset-btn" class="secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            重置
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <h3>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                            </svg>
                            当前色彩规则
                        </h3>
                        <div id="current-rule-info" style="padding: 12px; background-color: var(--light-gray); border-radius: 8px; font-size: 0.9rem;">
                            类似色方案：在色轮上相邻的颜色，通常相差30度，创造和谐的外观。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM元素
    const colorWheel = document.getElementById('color-wheel');
    const wheelContainer = document.getElementById('wheel-container');
    const markers = document.querySelectorAll('.color-marker');
    const baseColorInput = document.getElementById('base-color');
    const baseColorValue = document.getElementById('base-color-value');
    const colorRuleSelect = document.getElementById('color-rule');
    const randomBtn = document.getElementById('random-btn');
    const resetBtn = document.getElementById('reset-btn');
    const colorPalette = document.getElementById('color-palette');
    const currentRuleInfo = document.getElementById('current-rule-info');
    const exportFormatSelect = document.getElementById('export-format');
    const exportOutput = document.getElementById('export-output');
    const copyAllBtn = document.getElementById('copy-all-btn');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    // 状态变量
    let isDragging = false;
    let isDraggingMarker = false;
    let activeMarker = null;
    let startAngle = 0;
    let wheelRotation = 0;
    let currentHue = 0;
    let currentSaturation = 100;
    let currentLightness = 50;
    let wheelCenter = { x: 0, y: 0 };
    let wheelRadius = 0;

    // 初始化
    initColorWheel();
    setupEventListeners();
    updateWheelDimensions();
    updateColorMarkers();
    updateColorPalette();
    updateExportOutput();

    function initColorWheel() {
        const hex = baseColorInput.value;
        const rgb = hexToRgb(hex);
        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        currentHue = hsl.h;
        currentSaturation = hsl.s;
        currentLightness = hsl.l;
        baseColorValue.textContent = hex.toUpperCase();
    }

    function updateWheelDimensions() {
        const rect = colorWheel.getBoundingClientRect();
        wheelCenter = {
            x: rect.width / 2,
            y: rect.height / 2
        };
        wheelRadius = Math.min(rect.width, rect.height) / 2 ;
    }

    function setupEventListeners() {
        // 色轮拖动
        colorWheel.addEventListener('mousedown', startDrag);
        colorWheel.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('mousemove', handleDrag);
        document.addEventListener('touchmove', handleDrag, { passive: false });
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);

        // 标记点拖动
        markers.forEach(marker => {
            marker.addEventListener('mousedown', startDragMarker);
            marker.addEventListener('touchstart', startDragMarker, { passive: false });
        });

        // 控制面板
        baseColorInput.addEventListener('input', handleBaseColorChange);
        colorRuleSelect.addEventListener('change', handleColorRuleChange);
        randomBtn.addEventListener('click', generateRandomColors);
        resetBtn.addEventListener('click', resetColorWheel);

        // 导出功能
        exportFormatSelect.addEventListener('change', updateExportOutput);
        copyAllBtn.addEventListener('click', copyAllColors);

        // 标签页切换
        tabs.forEach(tab => {
            tab.addEventListener('click', switchTab);
        });

        // 窗口大小变化时更新尺寸
        window.addEventListener('resize', () => {
            updateWheelDimensions();
            updateColorMarkers();
        });
    }

    // 色轮交互函数
    function startDrag(e) {
        if (isDraggingMarker) return;
        e.preventDefault();
        isDragging = true;
        colorWheel.classList.add('dragging');
        
        const rect = colorWheel.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        
        startAngle = Math.atan2(clientY - centerY, clientX - centerX) * 180 / Math.PI - wheelRotation;
    }

    function handleDrag(e) {
        if (!isDragging && !isDraggingMarker) return;
        e.preventDefault();

        if (isDragging) {
            handleWheelDrag(e);
        } else if (isDraggingMarker) {
            handleMarkerDrag(e);
        }
    }

    function handleWheelDrag(e) {
        if (!isDragging) return;
        e.preventDefault();

        const rect = colorWheel.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        
        const currentAngle = Math.atan2(clientY - centerY, clientX - centerX) * 180 / Math.PI;
        
        const deltaAngle = currentAngle - startAngle;
        
        wheelRotation = (wheelRotation + deltaAngle)%360;
        if (wheelRotation < 0) wheelRotation += 360;

        startAngle = currentAngle;

        colorWheel.style.transform = `rotate(${wheelRotation}deg)`;
        
        currentHue = wheelRotation;
        const hex = hslToHex(currentHue, currentSaturation, currentLightness);
        baseColorInput.value = hex;
        baseColorValue.textContent = hex.toUpperCase();
        
        updateColorMarkers();
        updateColorPalette();
        updateExportOutput();
    }

    function handleMarkerDrag(e) {
        const containerRect = wheelContainer.getBoundingClientRect();
        
        // 计算相对于容器的位置
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        const x = clientX - containerRect.left;
        const y = clientY - containerRect.top;
        
        // 计算相对于中心的位置和角度
        const dx = x - wheelCenter.x;
        const dy = y - wheelCenter.y;
        const distance = Math.min(wheelRadius, Math.sqrt(dx*dx + dy*dy));
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        
        // 计算新位置
        const rad = angle * Math.PI / 180;
        const newX = wheelCenter.x + distance * Math.cos(rad);
        const newY = wheelCenter.y + distance * Math.sin(rad);
        
        // 更新标记点
        activeMarker.style.left = `${newX}px`;
        activeMarker.style.top = `${newY}px`;
        activeMarker.dataset.angle = (angle - wheelRotation + 360) % 360;
        
        // 更新颜色
        updateMarkerColor(activeMarker);
        updateColorPalette();
        updateExportOutput();
        updateMarkerColor(activeMarker);
    }

    function endDrag() {
        isDragging = false;
        isDraggingMarker = false;
        colorWheel.classList.remove('dragging');
        
        if (activeMarker) {
            activeMarker.classList.remove('active');
            activeMarker = null;
        }
    }

    function startDragMarker(e) {
        e.stopPropagation();
        e.preventDefault();
        isDraggingMarker = true;
        activeMarker = e.target;
        activeMarker.classList.add('active');
        
        if (colorRuleSelect.value !== 'custom') {
            colorRuleSelect.value = 'custom';
            handleColorRuleChange();
        }
    }

    // 颜色标记点更新函数
    function updateColorMarkers() {
        const rule = colorRuleSelect.value;
        
        const rulesConfig = {
        analogous: { angles: [-30,0,30,60,90], distances: [1,1,1,1,1] },
        monochromatic: { angles: [0,0,0,0,0], distances: [0.5,0.65,0.8,0.9,1] },
        triad: { angles: [0,120,240,60,300], distances: [1,1,1,0.9,0.9] },
        complementary: { angles: [0,180,90,270,45], distances: [1,1,0.9,0.9,0.8] },
        'split-complementary': { angles: [0,150,210,60,300], distances: [1,1,1,0.9,0.9] },
        'double-complementary': { angles: [0,180,30,210,60], distances: [1,1,0.9,0.9,0.8] },
        square: { angles: [0,90,180,270,45], distances: [1,1,1,1,0.9] },
        compound: { angles: [0,30,180,210,240], distances: [1,0.9,1,0.9,0.8] },
        shades: { angles: [0,0,0,0,0], distances: [0.6,0.75,0.85,0.95,1] },
        custom: { angles: [], distances: [] }
    };

        const config = rulesConfig[rule] || rulesConfig.analogous;
        
        markers.forEach((marker, i) => {
            if (config.angles[i] === undefined) return;
            
            const hueAngle = (currentHue + config.angles[i]) % 360;
            const visualAngle = (hueAngle - wheelRotation + 360) % 360;
            const distance = wheelRadius * (config.distances[i] || 1);
            const rad = visualAngle * Math.PI / 180;
            
            const x = wheelCenter.x + distance * Math.cos(rad);
            const y = wheelCenter.y + distance * Math.sin(rad);
            
            marker.style.left = `${x}px`;
            marker.style.top = `${y}px`;
            marker.dataset.angle = hueAngle;
            
            const hsl = calculateHSL(rule, hueAngle, i, distance/wheelRadius);
            const hex = hslToHex(hsl.h, hsl.s, hsl.l);
            marker.style.backgroundColor = hex;
            
            marker.classList.toggle('at-edge', distance >= wheelRadius*0.95);
        });
    }

    function updateMarkerColor(marker) {
        const angle = parseFloat(marker.dataset.angle);
        const markerX = parseFloat(marker.style.left);
        const markerY = parseFloat(marker.style.top);
        
        const dx = markerX - wheelCenter.x;
        const dy = markerY - wheelCenter.y;
        const distance = Math.sqrt(dx*dx + dy*dy);
        const distanceRatio = distance / wheelRadius;
        
        const hsl = calculateHSL('custom', angle, 0, distanceRatio);
        const hex = hslToHex(hsl.h, hsl.s, hsl.l);
        marker.style.backgroundColor = hex;
    }

    function calculateHSL(rule, angle, index, distanceRatio = 1) {
        let h = angle, s = 100, l = 50;
        
        switch(rule) {
            case 'monochromatic':
                s = 100 - index * 10;
                l = 30 + index * 15;
                break;
            case 'shades':
                s = 100 - index * 15;
                l = 50 - index * 5;
                break;
            case 'custom':
                s = Math.min(100, Math.round(distanceRatio * 100));
                break;
            default:
                // 其他规则保持默认
        }
        
        return { h, s, l };
    }

    // 控制面板函数
    function handleBaseColorChange() {
        const hex = this.value;
        const rgb = hexToRgb(hex);
        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
        
        currentHue = hsl.h;
        currentSaturation = hsl.s;
        currentLightness = hsl.l;
        
        baseColorValue.textContent = hex.toUpperCase();
        wheelRotation = currentHue;
        colorWheel.style.transform = `rotate(${wheelRotation}deg)`;
        
        updateColorMarkers();
        updateColorPalette();
        updateExportOutput();
    }

    function handleColorRuleChange() {
        updateRuleDescription(colorRuleSelect.value);
        updateColorMarkers();
        updateColorPalette();
        updateExportOutput();
    }

    function updateRuleDescription(rule) {
        const descriptions = {
            'analogous': '类似色方案：在色轮上相邻的颜色，通常相差30度，创造和谐的外观。',
            'monochromatic': '单色方案：使用单一色调的不同明暗变化，创造简洁统一的效果。',
            'triad': '三色方案：色轮上均匀分布的三种颜色，彼此相隔120度，提供丰富的对比。',
            'complementary': '互补色方案：色轮上相对的两种颜色（相差180度），创造强烈的对比效果。',
            'split-complementary': '分裂互补色方案：一种基础色加上其互补色两侧的两种颜色，对比强烈但比互补色更柔和。',
            'double-complementary': '双重互补色方案：两组互补色（共四种颜色），提供丰富的色彩组合。',
            'square': '四色方案：色轮上均匀分布的四种颜色，彼此相隔90度，色彩丰富且平衡。',
            'compound': '复合色方案：类似色加上互补色，既和谐又有对比。',
            'shades': '阴影方案：单一色调的不同饱和度变化，从鲜艳到柔和的过渡。',
            'custom': '自定义方案：您可以自由调整每个色点的位置和颜色。'
        };
        
        currentRuleInfo.textContent = descriptions[rule] || '';
    }

    function generateRandomColors() {
        currentHue = Math.floor(Math.random() * 360);
        currentSaturation = 70 + Math.floor(Math.random() * 30);
        currentLightness = 40 + Math.floor(Math.random() * 30);
        
        const hex = hslToHex(currentHue, currentSaturation, currentLightness);
        baseColorInput.value = hex;
        baseColorValue.textContent = hex.toUpperCase();
        
        const rules = Array.from(colorRuleSelect.options)
            .map(opt => opt.value)
            .filter(val => val !== 'custom');
        
        const randomRule = rules[Math.floor(Math.random() * rules.length)];
        colorRuleSelect.value = randomRule;
        
        wheelRotation = currentHue;
        colorWheel.style.transform = `rotate(${wheelRotation}deg)`;
        
        updateRuleDescription(randomRule);
        updateColorMarkers();
        updateColorPalette();
        updateExportOutput();
    }

    function resetColorWheel() {
        currentHue = 0;
        currentSaturation = 100;
        currentLightness = 50;
        
        baseColorInput.value = '#ff0000';
        baseColorValue.textContent = '#FF0000';
        
        colorRuleSelect.value = 'analogous';
        wheelRotation = 0;
        colorWheel.style.transform = 'rotate(0deg)';
        
        updateRuleDescription('analogous');
        updateColorMarkers();
        updateColorPalette();
        updateExportOutput();
    }

    // 调色板函数
    function updateColorPalette() {
        colorPalette.innerHTML = '';
        
        markers.forEach((marker, index) => {
            const color = marker.style.backgroundColor;
            const hexColor = rgbToHex(color);
            const rgbColor = hexToRgb(hexColor);
            const hslColor = rgbToHsl(rgbColor.r, rgbColor.g, rgbColor.b);
            
            const colorCard = document.createElement('div');
            colorCard.className = 'color-card';
            colorCard.style.animationDelay = `${index * 0.1}s`;
            
            colorCard.innerHTML = `
                <div class="color-swatch" style="background-color: ${color};">
                    <button class="copy-btn" data-color="${hexColor}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                    </button>
                </div>
                <div class="color-info">
                    <div class="color-hex">${hexColor.toUpperCase()}</div>
                    <div class="color-rgb">RGB: ${rgbColor.r}, ${rgbColor.g}, ${rgbColor.b}</div>
                    <div class="color-rgb">HSL: ${hslColor.h}°, ${hslColor.s}%, ${hslColor.l}%</div>
                </div>
            `;
            
            colorPalette.appendChild(colorCard);
        });
        
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const color = this.getAttribute('data-color');
                navigator.clipboard.writeText(color);
                
                const originalHTML = this.innerHTML;
                this.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                `;
                
                setTimeout(() => {
                    this.innerHTML = originalHTML;
                }, 1000);
            });
        });
    }

    // 导出功能
    function updateExportOutput() {
        const format = exportFormatSelect.value;
        let output = '';
        
        const colors = Array.from(markers).map(marker => {
            const color = marker.style.backgroundColor;
            const hex = rgbToHex(color);
            const rgb = hexToRgb(hex);
            const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
            
            return { hex, rgb, hsl };
        });
        
        switch(format) {
            case 'hex':
                output = colors.map(c => c.hex.toUpperCase()).join(', ');
                break;
            case 'rgb':
                output = colors.map(c => `rgb(${c.rgb.r}, ${c.rgb.g}, ${c.rgb.b})`).join(',\n');
                break;
            case 'hsl':
                output = colors.map(c => `hsl(${c.hsl.h}, ${c.hsl.s}%, ${c.hsl.l}%)`).join(',\n');
                break;
            case 'css':
                output = ':root {\n';
                colors.forEach((c, i) => {
                    output += `    --color-${i + 1}: ${c.hex.toUpperCase()};\n`;
                    output += `    --color-${i + 1}-rgb: ${c.rgb.r}, ${c.rgb.g}, ${c.rgb.b};\n`;
                    output += `    --color-${i + 1}-hsl: ${c.hsl.h}deg, ${c.hsl.s}%, ${c.hsl.l}%;\n`;
                });
                output += '}';
                break;
            case 'json':
                output = JSON.stringify({
                    palette: colors.map(c => ({
                        hex: c.hex.toUpperCase(),
                        rgb: c.rgb,
                        hsl: c.hsl
                    })),
                    rule: colorRuleSelect.options[colorRuleSelect.selectedIndex].text,
                    baseColor: baseColorInput.value.toUpperCase()
                }, null, 2);
                break;
            default:
                output = colors.map(c => c.hex.toUpperCase()).join(', ');
        }
        
        exportOutput.value = output;
    }

    function copyAllColors() {
        navigator.clipboard.writeText(exportOutput.value);
        
        const originalText = copyAllBtn.innerHTML;
        copyAllBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            已复制!
        `;
        
        setTimeout(() => {
            copyAllBtn.innerHTML = originalText;
        }, 2000);
    }

    // 标签页切换
    function switchTab(e) {
        const tabId = e.target.getAttribute('data-tab');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        e.target.classList.add('active');
        document.getElementById(`${tabId}-tab`).classList.add('active');
    }

    // 颜色转换函数
    function hexToRgb(hex) {
        const r = parseInt(hex.substring(1, 3), 16);
        const g = parseInt(hex.substring(3, 5), 16);
        const b = parseInt(hex.substring(5, 7), 16);
        return { r, g, b };
    }

    function rgbToHsl(r, g, b) {
        r /= 255, g /= 255, b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;
    
        if (max === min) {
            h = s = 0;
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h *= 60;
        }
    
        return { h: Math.round(h), s: Math.round(s * 100), l: Math.round(l * 100) };
    }

    function hslToHex(h, s, l) {
        l /= 100;
        const a = s * Math.min(l, 1 - l) / 100;
        const f = n => {
            const k = (n + h / 30) % 12;
            const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
            return Math.round(255 * color).toString(16).padStart(2, '0');
        };
        return `#${f(0)}${f(8)}${f(4)}`;
    }

    function rgbToHex(rgbStr) {
        if (rgbStr.startsWith('#')) return rgbStr.toLowerCase();
        
        const rgb = rgbStr.match(/\d+/g);
        if (!rgb || rgb.length < 3) return '#000000';
        
        return `#${parseInt(rgb[0]).toString(16).padStart(2, '0')}${parseInt(rgb[1]).toString(16).padStart(2, '0')}${parseInt(rgb[2]).toString(16).padStart(2, '0')}`;
    }
});
    </script>
</body>
</html>